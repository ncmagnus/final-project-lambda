---
title: "Vignette for ODTR package"
author: "Lina Montoya and Nina Magnuson"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  library(ODTR), 
  library(SuperLearner),
  library(hitandrun)
)
```
\section{Description}
ODTR computes the simple or optimal dynamic treatment rule for data of the form O <- (W, A, Y). W represents covariates uneffected by treatment, A. Treatment A is a binary vector indicating whether treatment was received. Y is a vector for the outcome measured at the end of the study. This allows for analysis of treatment, i.e. how to optimize treatment design.  


\section{Example Using Simulated Data}
In order to illustrate the use of ODTR, first use the data.simulation function to create some data. Next we must define the relevant variables for reading into odtr and sodtr. 
```{r}
set.seed(37982)
data <- data.simulation(n=1000)
W = data[,grep("W", names(data))]
W_for_g = subset(W, select = c(W1, W2))
A = data$A
a = 0
Y = data$Y
rule = ifelse(data$W2 > 0, 1, 0) #for simple dynamic treatment 
QAW.SL.library = "SL.correct"

#test the simulated data

```
\subsection{Finding Simple Dynamic Treatment Rule}
Using function sodtr we will use the simulated data to compute the simple optimal treatment rule.
```{r}
resultssimple = sodtr(W = W, W_for_g = W, a = a, A = A, Y = Y, 
                              rule = rule, 
                              QAW.SL.library = QAW.SL.library)
resultssimple
```
Include explanation of results.
\subsection{Finding Optimal Dynamic Treatment Rule}
Next we will find the optimal dynamic treatment rule for this simulated data. 
```{r}
# note V must contain W_for_g
V = subset(W, select = c(W1, W2))
grid.size = 100
risk.type = "empirical"
QAV.SL.library = c("SL.glm", "SL.glmnet", "SL.mean")
resultsODTR = odtr(W = W, A = A, a = a, Y = Y, V = V, W_for_g = W_for_g,
                          QAW.SL.library = QAW.SL.library, 
                          QAV.SL.library = QAV.SL.library,
                          risk.type = risk.type,
                          grid.size = grid.size)
resultsODTR
```
Analysis of results. 
